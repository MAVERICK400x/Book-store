<!DOCTYPE html>
<html lang="en">
<head>
    <title>Shopping Cart - Online Bookstore</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">Online Bookstore</a>
            
            <!-- Navbar Right Side -->
            <div class="ms-auto">
                <% if (user) { %>
                    <span class="navbar-text text-white me-3">Welcome, <%= user.username %>!</span>
                    <a href="/orders" class="btn btn-success btn-sm">Orders</a>
                    <a href="/users/logout" class="btn btn-danger btn-sm">Logout</a>
                <% } else { %>
                    <a href="/users/login" class="btn btn-info btn-sm">Login</a>
                    <a href="/users/register" class="btn btn-warning btn-sm">Register</a>
                <% } %>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <h2>Shopping Cart</h2>
        <% if (cart.length > 0) { 
            let subtotal = cart.reduce((sum, item) => sum + item.price, 0); 
            let gst = subtotal * 0.18; // 18% GST
            let shipping = 50; // Flat shipping charge
            let grandTotal = subtotal + gst + shipping;
        %>
            <table class="table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Author</th>
                        <th>Price (‚Çπ)</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% cart.forEach((item, index) => { %>
                        <tr>
                            <td><%= item.title %></td>
                            <td><%= item.author %></td>
                            <td>‚Çπ<%= item.price %></td>
                            <td>
                                <a href="/cart/remove/<%= index %>" class="btn btn-danger btn-sm">Remove</a>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>

            <!-- Price Breakdown -->
            <h4 class="mt-3">Subtotal: ‚Çπ<%= subtotal.toFixed(2) %></h4>
            <h5>GST (18%): ‚Çπ<%= gst.toFixed(2) %></h5>
            <h5>Shipping: ‚Çπ<%= shipping %></h5>
            <h3><strong>Grand Total: ‚Çπ<%= grandTotal.toFixed(2) %></strong></h3>

            <p class="text-danger fw-bold mt-3">‚ö† Once an order is created, no cancellation is applied.</p>
            <p class="text-danger fw-bold">‚ö† We only deliver within India.</p>
            <!-- Address & Phone Number Form for Checkout -->
            <form action="/orders/place" method="POST">
                <div class="mb-3">
                    <label for="address" class="form-label">Shipping Address</label>
                    <textarea name="address" id="address" class="form-control" rows="3" placeholder="Enter full address" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="phone" class="form-label">Phone Number for Updates</label>
                    <input type="tel" name="phone" id="phone" class="form-control" pattern="[0-9]{10}" placeholder="Enter 10-digit phone number" required>
                </div>
                <button type="submit" class="btn btn-success">Proceed to Checkout</button>
            </form>            
        <% } else { %>
            <p>Your cart is empty!</p>
        <% } %>

        <!-- Back Buttons -->
        <div class="mt-4">
            <a href="/products" class="btn btn-primary">‚Üê Add Books</a>
            <a href="/" class="btn btn-secondary">‚Üê Back to Home</a>
        </div>
    </div>

    <!-- Footer
    <footer class="bg-dark text-white text-center py-3 mt-5">
        <p>¬© 2025 Online Bookstore. All rights reserved.</p>
        <p>Contact us: üìû <strong>+91 98765 43210</strong></p>
        <p>Follow us on: 
            <a href="#" class="text-white mx-2">Facebook</a> | 
            <a href="#" class="text-white mx-2">Instagram</a> | 
            <a href="#" class="text-white mx-2">Twitter</a>
        </p>
    </footer> -->
</body>
</html>
